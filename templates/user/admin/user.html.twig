{% extends 'base.html.twig' %}

{% block title %}{{ user.member.fullName }}{% endblock %}

{% block body %}
 <div class="wrapper">
        <div class="block">
            <div class="block-title" {% if user.level is not null %} style="background-color: {{ user.level.color }}"{% endif %}>
                <h2>
                    {{ user.member.fullName }}
                </h2>
                <span class="tools">
                    {% if is_granted('ROLE_ALLOWED_TO_SWITCH') %}
                        <a class="btn btn-primary btn-ico" href="{{ path('home', {'_switch_user': user.licenceNumber}) }}"><i class="fas fa-exchange-alt"></i></a>
                    {% endif %}
                    <a href="{{ referer is defined ? referer : path('admin_users', {'filtered': 1}) }}"
                        class="btn btn-secondary btn-ico" title="Retour à la liste des adhérents">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </span>
            </div>
            <div class="block-body row padding-10" style="align-items: flex-start;">
                {% set licence = user.lastLicence(licence_service.currentSeason) %}
                {% if user.member.picture %}
                    <div class="col-md-2 col-xs-4">
                        <img src="{{ '/uploads/' ~ user.member.picture }}" style="width: 100px;">
                    </div>
                {% endif %}
                <div class="col-md-5 col-xs-8">
                    <ul>
                        <li><b>Né(e) le : </b>{{ user.member.birthDate }}</li>
                        <li><i class="fas fa-map-marker-alt"></i> {{ user.member.address.street }}</li>
                        <li>{{ user.member.address.postalCode }} {{ user.member.address.town }}</li>
                        <li><i class="fas fa-at"></i> {{ user.member.email }}</li>
                        <li><i class="fas fa-phone-square"></i> {{ user.member.phone }}</li>
                        {% if user.approvalGoingHome is not null %}
                            <li class="{{ user.approvalGoingHome.class }}">{{ user.approvalGoingHome.message }}</li>
                        {% endif %}
                    </ul>
                  {% if is_granted('ROLE_REGISTER') %}
                        <a href="{{ path('admin_identity_edit', {'user': user.id}) }}"
                            class="btn btn-secondary marging-bottom-20" title="Modifier">
                            <i class="fas fa-edit"></i> Modifier
                        </a>
                    {% endif %}
                </div>
                {% if licence is not empty %}
                    <div class="col-md-5 col-xs-12">
                        <ul>
                            <li><b>Licence :</b> {{ user.licenceNumber }}</li>
                            <li><b>Saison {{ licence.season }}</b></li>
                            {% if licence.status is not null %}
                                <li>{{ licence.statusStr|trans }}</li>
                            {% endif %}
                            {% if not licence.isFinal %}
                                <li>Période de test en cours</li>
                                <li>Nombre de sortie(s) : {{ user.testingBikeRides }}</li>
                            {% endif %}

                            {% if licence.type is not null %}
                                <li><b>Type : </b>{{ licence.type|trans }}</li>
                            {% endif %}
                            {% if licence.coverage is not null %}
                                <li><b>Assurance : </b>{{ licence.coverageStr|trans }}</li>
                            {% endif %}

                            {% if user.level is not null %}
                                <li><b>{{ constant('App\\Entity\\Level::TYPES')[user.level.type] | trans }} : </b> {{ user.level }}</li>
                            {% endif %}
                        </ul>
                        {% if is_granted('ROLE_REGISTER') %}
                            <a href="{{ path('admin_user_edit', {'user': user.id}) }}"
                                class="btn btn-secondary marging-bottom-20" title="Modifier">
                                <i class="fas fa-edit"></i> Modifier
                            </a>
                        {% endif %}
                    </div>
                    {% if user.kinship is not empty %}
                        <div class="col-md-6 col-xs-12">
                            <ul>
                                <li><b>{{ user.kinship.type | trans  }}</b> : {{ user.kinship.fullName }} </li>
                                <li><i class="fas fa-map-marker-alt"></i> {{ user.kinship.address.street }}</li>
                                <li>{{ user.kinship.address.postalCode }} {{ user.kinship.address.town }}</li>
                                <li><i class="fas fa-at"></i> {{ user.kinship.email }}</li>
                                <li><i class="fas fa-phone-square"></i> {{ user.kinship.phone }}</li>
                            </ul>
                        </div>
                    {% endif %}
                    {% if user.secondKinship is not empty %}
                        <div class="col-md-6 col-xs-12">
                            <ul>
                                <li><b>{{ user.secondKinship.type | trans  }}</b> : {{ user.secondKinship.fullName }} </li>
                                <li><i class="fas fa-phone-square"></i> {{ user.secondKinship.phone }}</li>
                            </ul>
                        </div>
                    {% endif %}
                    {% if is_granted('ROLE_REGISTER') and (user.secondKinship is not empty or user.secondKinship is not empty) %}
                        <div class="col-md-12 col-xs-12">
                            <a href="{{ path('admin_identity_edit', {'user': user.id, 'isKinship': 1}) }}"
                                class="btn btn-secondary marging-bottom-20" title="Modifier">
                                <i class="fas fa-edit"></i> Modifier
                            </a>
                        </div>
                        <br>
                    {% endif %}

                    {% if licence.category == constant('App\\Entity\\Licence::CATEGORY_MINOR') and licence.isFinal and user.health is not empty %}
                        <div class="col-md-6 col-xs-12">
                            <ul>
                                <li><b>N° de sécurité sociale : </b> {{ user.health.socialSecurityNumber }} </li>
                                <li><b>Groupe sanguin : </b> {{ user.health.bloodGroup }}</li>
                                <li><b>Mutuelle : </b>{{ user.health.mutualCompany }} - N° : </b>{{ user.health.mutualNumber }}</li>
                                <li><b><i class="fas fa-syringe"></i> antitétanique : </b>{{ user.health.tetanusBooster }}</li>
                                <li><b>Médecin traitant : </b>{{ user.health.doctorName }}</li>
                                <li>{{ user.health.doctorAddress }} {{ user.health.doctorTown }} <i class="fas fa-phone-square"></i> {{ user.health.doctorPhone }}</li>
                            </ul>
                        </div>
                    
                        {% if user.health.diseases is not empty %}
                            <div class="col-md-6 col-xs-12">
                                {% for type, diseases in user.health.diseases %}
                                    <h3>{{ constant('App\\Entity\\Disease::TYPES')[type] | trans }}</h3>
                                    <ul class="with-list-style">
                                        {% for disease in diseases %}
                                            <li>
                                                {{ constant('App\\Entity\\Disease::LABELS')[disease.label] | trans }}
                                                {% if disease.title is not null %} : {{ disease.title }}{% endif %}
                                                <i class="fas fa-file-medical"></i> {{ disease.curentTreatment }} <i class="fas fa-ambulance"></i> {{ disease.emergencyTreatment }}
                                            </li>
                                        {% endfor %}
                                    </ul>
                                {% endfor %}
                            </div>
                        {% endif %}
                        {% if is_granted('ROLE_REGISTER')  %}
                            <div class="col-md-12 col-xs-12">
                            <a href="{{ path('admin_health_edit', {'user': user.id}) }}"
                                class="btn btn-secondary marging-bottom-20" title="Modifier">
                                <i class="fas fa-edit"></i> Modifier
                            </a>
                            </div>
                        {% endif %}
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
