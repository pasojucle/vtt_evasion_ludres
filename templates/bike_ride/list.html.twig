{% extends 'base.html.twig' %}

{% block title %}Calendrier des sorties{% endblock %}

{% block body %}
    <div class="wrapper wrapper-full-width full-background">
        <div class="wrapper-title">
            <h1>Programme</h1>
        </div>
        <div class="wrapper-body">
            {% include('bike_ride/filter.html.twig') %}
            <div class="bike-rides"> 
                {% for bikeRide in bikeRides %}
                    {% set class = '' %}    
                    {% if bikeRide.isNext %}
                        {% set class = 'active' %}  
                    {% elseif bikeRide.over %}
                        {% set class = 'disable' %}  
                    {% endif %}
                    {% set btn_label = 'S\'incrire' %}
                    {% if bikeRide.accessAvailabity(app.user) %}
                        {% set btn_label = 'DisponibilitÃ©' %}
                    {% endif %}
                    {% set isRegistrable = bikeRide.isRegistrable %}
                    {% if isRegistrable and app.user is not null and bikeRide.id == 51 and app.user.firstIdentity.birthDate|date('Y') %}
                        {% set userAge = app.user.firstIdentity.birthDate|date('Y') %}
                        {% set isRegistrable = 2010 > userAge %}
                    {% endif %}
                    <div class="bike-ride-date item-center align-center {{ class }} reveal">
                        <div>
                            {% if bikeRide.endAt is null %}
                                {{ bikeRide.startAt | formatDateLong }}
                            {% else %}
                                du {{ bikeRide.startAt | formatDateLong }} au {{ bikeRide.endAt | formatDateLong }} 
                            {% endif %}
                            {% if isRegistrable or bikeRide.accessAvailabity(app.user) %}
                                <div class="bike-ride-date-btn">
                                    <br>
                                    <a href="{{ path('session_add', {'bikeRide': bikeRide.id}) }}" class="btn btn-secondary"><i class="fas fa-chevron-circle-right"></i> {{ btn_label }}</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    <div class="bike-ride-detail {{ class }} reveal">
                        <h3>{{ bikeRide.title }}</h3>
                        {% if bikeRide.minAge is not null %}
                            <p class='info'>A partir de {{ bikeRide.minAge }} ans</p>
                        {% endif %}
                        <p>{{ bikeRide.content |raw }}</p>
                    </div>
                    {% if isRegistrable or bikeRide.accessAvailabity(app.user) %}
                        <div class="bike-ride-btn item-center align-center {{ class }} reveal">
                            <a href="{{ path('session_add', {'bikeRide': bikeRide.id}) }}" class="btn btn-secondary"><i class="fas fa-chevron-circle-right"></i> {{ btn_label }}</a>
                        </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% include('common/pagination.html.twig') %}
    </div>
{% endblock %}
